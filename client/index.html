<!DOCTYPE=html>
<html>

<head>
  <meta charset="utf-8" />
  <title></title>
  <style>
    html,
    body {
      margin: 0% auto;
      background-color: 'black';
    }
  </style>
</head>

<body>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
  <script src="serverConnection.js"></script>
  <script src="requests.js"></script>
  <script src="canvasSetup.js"></script>

  <script>
  var playerTime=null;
    var grid
    var token = localStorage.getItem('token') || null;
    gridWidth = 60;
    gridHeight = 30;

    var keystate;
    var canvas, ctx,
      canX = [],
      canY = [],
      mouseIsDown = 0,
      touchCount = 0;
    var tttouch = 0;
    var width;
    var height;

    var mouseX;
    var mouseY;
    var pointWidth;

    var cursorX = 0;
    var cursorY = 0;



    init();
    var loop = function() {
      if (grid != null) {
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        for (var y = 0; y < gridHeight; y++) {
          for (var x = 0; x < gridWidth; x++) {
            point = grid[y][x];
            if (grid[y][x].team == null) {
              ctx.fillStyle = "#e2e2e2";
              ctx.fillRect(x * pointWidth, y * pointHeight, pointWidth, pointHeight);
            }
            if (grid[y][x].team == 0) {
              ctx.fillStyle = "#13294b";
              ctx.fillRect(x * pointWidth, y * pointHeight, pointWidth, pointHeight);
            }
            if (grid[y][x].team == 1) {
              ctx.fillStyle = "#E84A27";
              ctx.fillRect(x * pointWidth, y * pointHeight, pointWidth, pointHeight);
            }
            if (grid[y][x].object != null) {
              if (grid[y][x].object.type == "soldier") {
                if (grid[y][x].object.team == 0) {
                  ctx.fillStyle = "blue";
                  ctx.fillRect(x * pointWidth, y * pointHeight, pointWidth, pointHeight);
                }
                if (grid[y][x].object.team == 1) {
                  ctx.fillStyle = "orange";
                  ctx.fillRect(x * pointWidth, y * pointHeight, pointWidth, pointHeight);
                }
              }
              if (grid[y][x].object.type == "wall") {
                if (grid[y][x].object.team == 0) {
                  ctx.fillStyle = "#4876ba";
                  ctx.fillRect(x * pointWidth, y * pointHeight, pointWidth, pointHeight);
                }
                if (grid[y][x].object.team == 1) {
                  ctx.fillStyle = "#e8785f";
                  ctx.fillRect(x * pointWidth, y * pointHeight, pointWidth, pointHeight);
                }
              }
            }
          }
        }
        ctx.fillStyle = "black";
        ctx.lineWidth = "4";
        ctx.strokeRect(cursorX * pointWidth, cursorY * pointHeight, pointWidth, pointHeight);
      } else {
        console.log("no grid");
      }
      window.requestAnimationFrame(loop, canvas);
    }
    window.requestAnimationFrame(loop, canvas);

    var click = function() {
      x = parseInt(mouseX / canvas.width * gridWidth);
      y = parseInt(mouseY / canvas.height * gridHeight);
      console.log(x + ", " + y);
      //TODO: procces click as request based on current menu selection
      placeSoldier(x, y, 1, 0)
    }
    var updateCursor = function() {
      cursorX = parseInt(mouseX / canvas.width * gridWidth);
      cursorY = parseInt(mouseY / canvas.height * gridHeight);
    }
  </script>
</body>

</html>
